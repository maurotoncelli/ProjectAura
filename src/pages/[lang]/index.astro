---
import { getHomeContent } from '../../lib/data';
import MainLayout from '../../layouts/MainLayout.astro';
import { SUPPORTED_LANGS, type Lang } from '../../i18n/index';

// Section Components
import HeroSection from '../../components/sections/home/HeroSection.astro';
import PhilosophySection from '../../components/sections/home/PhilosophySection.astro';
import TechSection from '../../components/sections/home/TechSection.astro';
import DarkVoidSection from '../../components/sections/home/DarkVoidSection.astro';
import MaterialSection from '../../components/sections/home/MaterialSection.astro';
import GenesisSection from '../../components/sections/home/GenesisSection.astro';
import SmartContextSection from '../../components/sections/home/SmartContextSection.astro';
import ElementalFlow from '../../components/sections/home/ElementalFlow.astro';
import LifestyleSection from '../../components/sections/home/LifestyleSection.astro';
import EsteticaGrid from '../../components/sections/home/EsteticaGrid.astro';
import HeritageSection from '../../components/sections/home/HeritageSection.astro';
import DetailsSection from '../../components/sections/home/DetailsSection.astro';
import NextChapterFooter from '../../components/sections/home/NextChapterFooter.astro';

export function getStaticPaths() {
  return SUPPORTED_LANGS.map(lang => ({ params: { lang } }));
}

const { lang } = Astro.params as { lang: Lang };
const home = getHomeContent();
---

<MainLayout title="AETHER | Smart Wood Design" page="home" lang={lang}>
  <HeroSection />
  <PhilosophySection />
  <TechSection />
  <DarkVoidSection />
  <MaterialSection />
  <GenesisSection />
  <SmartContextSection />
  <ElementalFlow />
  <LifestyleSection />
  <EsteticaGrid />
  <HeritageSection />
  <DetailsSection />
  <NextChapterFooter
    label={home.nextChapter.label}
    heading={home.nextChapter.heading}
    linkText={home.nextChapter.linkText}
    href={home.nextChapter.href}
    image={home.nextChapter.image}
  />
</MainLayout>

<script>
  import { initHomePage } from '../../lib/home-animations';
  import { initScrollAnimations } from '../../lib/scroll-animations';
  import { ScrollTrigger } from 'gsap/ScrollTrigger';

  function bootHomePage() {
    // 1. Create all page-specific pins (TechSection, ElementalFlow, Lifestyle)
    initHomePage();
    // 2. Create global scroll-driven animations (img-reveal, parallax, text-clip)
    //    MUST run AFTER all pins are created so trigger positions account for pin spacers.
    initScrollAnimations();
    // 3. Single refresh AFTER all pins + scroll animations are in place.
    ScrollTrigger.refresh();
  }

  // astro:page-load fires on initial load AND after every View Transition.
  // The guard ensures boot only runs when we're actually on the home page.
  document.addEventListener('astro:page-load', () => {
    if (document.body.dataset.page === 'home') bootHomePage();
  });
</script>
